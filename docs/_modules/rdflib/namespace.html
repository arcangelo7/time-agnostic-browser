
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>rdflib.namespace &#8212; Time Agnostic Browser  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/material.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=blue-grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#_modules/rdflib/namespace" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../index.html" title="Time Agnostic Browser  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Time Agnostic Browser  documentation</span>
          <span class="md-header-nav__topic"> rdflib.namespace </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../../search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="../../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../"versions.json"",
        target_loc = "../../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="../../index.html" class="md-tabs__link">Time Agnostic Browser  documentation</a></li>
          <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Module code</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../index.html" title="Time Agnostic Browser documentation" class="md-nav__button md-logo">
      
        <img src="../../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../../index.html"
       title="Time Agnostic Browser documentation">Time Agnostic Browser  documentation</a>
  </label>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
  <ul class="md-nav__list" data-md-scrollfix="">
    

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <h1 id="modules-rdflib-namespace--page-root">Source code for rdflib.namespace</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">unicodedata</span> <span class="kn">import</span> <span class="n">category</span>

<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">string_types</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="kn">import</span> <span class="n">text_type</span>

<span class="kn">from</span> <span class="nn">six.moves.urllib.request</span> <span class="kn">import</span> <span class="n">pathname2url</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.parse</span> <span class="kn">import</span> <span class="n">urldefrag</span>
<span class="kn">from</span> <span class="nn">six.moves.urllib.parse</span> <span class="kn">import</span> <span class="n">urljoin</span>

<span class="kn">from</span> <span class="nn">rdflib.term</span> <span class="kn">import</span> <span class="n">URIRef</span><span class="p">,</span> <span class="n">Variable</span><span class="p">,</span> <span class="n">_XSD_PFX</span><span class="p">,</span> <span class="n">_is_valid_uri</span>

<span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">===================</span>
<span class="s2">Namespace Utilities</span>
<span class="s2">===================</span>

<span class="s2">RDFLib provides mechanisms for managing Namespaces.</span>

<span class="s2">In particular, there is a :class:`~rdflib.namespace.Namespace` class</span>
<span class="s2">that takes as its argument the base URI of the namespace.</span>

<span class="s2">.. code-block:: pycon</span>

<span class="s2">    &gt;&gt;&gt; from rdflib.namespace import Namespace</span>
<span class="s2">    &gt;&gt;&gt; owl = Namespace('http://www.w3.org/2002/07/owl#')</span>

<span class="s2">Fully qualified URIs in the namespace can be constructed either by attribute</span>
<span class="s2">or by dictionary access on Namespace instances:</span>

<span class="s2">.. code-block:: pycon</span>

<span class="s2">    &gt;&gt;&gt; owl.seeAlso</span>
<span class="s2">    rdflib.term.URIRef(u'http://www.w3.org/2002/07/owl#seeAlso')</span>
<span class="s2">    &gt;&gt;&gt; owl['seeAlso']</span>
<span class="s2">    rdflib.term.URIRef(u'http://www.w3.org/2002/07/owl#seeAlso')</span>


<span class="s2">Automatic handling of unknown predicates</span>
<span class="s2">-----------------------------------------</span>

<span class="s2">As a programming convenience, a namespace binding is automatically</span>
<span class="s2">created when :class:`rdflib.term.URIRef` predicates are added to the graph.</span>

<span class="s2">Importable namespaces</span>
<span class="s2">-----------------------</span>

<span class="s2">The following namespaces are available by directly importing from rdflib:</span>

<span class="s2">* RDF</span>
<span class="s2">* RDFS</span>
<span class="s2">* OWL</span>
<span class="s2">* XSD</span>
<span class="s2">* FOAF</span>
<span class="s2">* SKOS</span>
<span class="s2">* DOAP</span>
<span class="s2">* DC</span>
<span class="s2">* DCTERMS</span>
<span class="s2">* VOID</span>

<span class="s2">.. code-block:: pycon</span>

<span class="s2">    &gt;&gt;&gt; from rdflib import OWL</span>
<span class="s2">    &gt;&gt;&gt; OWL.seeAlso</span>
<span class="s2">    rdflib.term.URIRef(u'http://www.w3.org/2002/07/owl#seeAlso')</span>

<span class="s2">"""</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'is_ncname'</span><span class="p">,</span> <span class="s1">'split_uri'</span><span class="p">,</span> <span class="s1">'Namespace'</span><span class="p">,</span>
    <span class="s1">'ClosedNamespace'</span><span class="p">,</span> <span class="s1">'NamespaceManager'</span><span class="p">,</span>
    <span class="s1">'XMLNS'</span><span class="p">,</span> <span class="s1">'RDF'</span><span class="p">,</span> <span class="s1">'RDFS'</span><span class="p">,</span> <span class="s1">'XSD'</span><span class="p">,</span> <span class="s1">'OWL'</span><span class="p">,</span>
    <span class="s1">'SKOS'</span><span class="p">,</span> <span class="s1">'DOAP'</span><span class="p">,</span> <span class="s1">'FOAF'</span><span class="p">,</span> <span class="s1">'DC'</span><span class="p">,</span> <span class="s1">'DCTERMS'</span><span class="p">,</span> <span class="s1">'VOID'</span><span class="p">]</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Namespace</span><span class="p">(</span><span class="n">text_type</span><span class="p">):</span>

    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">    Utility class for quickly generating URIRefs with a common prefix</span>

<span class="s2">    &gt;&gt;&gt; from rdflib import Namespace</span>
<span class="s2">    &gt;&gt;&gt; n = Namespace("http://example.org/")</span>
<span class="s2">    &gt;&gt;&gt; n.Person # as attribute</span>
<span class="s2">    rdflib.term.URIRef(u'http://example.org/Person')</span>
<span class="s2">    &gt;&gt;&gt; n['first-name'] # as item - for things that are not valid python identifiers</span>
<span class="s2">    rdflib.term.URIRef(u'http://example.org/first-name')</span>

<span class="s2">    """</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rt</span> <span class="o">=</span> <span class="n">text_type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">rt</span> <span class="o">=</span> <span class="n">text_type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rt</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="bp">self</span> <span class="o">+</span> <span class="s1">'title'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># need to handle slices explicitly because of __getitem__ override</span>
        <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="k">else</span> <span class="s1">''</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">term</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"__"</span><span class="p">):</span>  <span class="c1"># ignore any special Python names!</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">term</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"Namespace(</span><span class="si">%r</span><span class="s2">)"</span> <span class="o">%</span> <span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">URIPattern</span><span class="p">(</span><span class="n">text_type</span><span class="p">):</span>

    <span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">    Utility class for creating URIs according to some pattern</span>
<span class="s2">    This supports either new style formatting with .format</span>
<span class="s2">    or old-style with </span><span class="si">% o</span><span class="s2">perator</span>

<span class="s2">    &gt;&gt;&gt; u=URIPattern("http://example.org/</span><span class="si">%s</span><span class="s2">/</span><span class="si">%d</span><span class="s2">/resource")</span>
<span class="s2">    &gt;&gt;&gt; u%('books', 12345)</span>
<span class="s2">    rdflib.term.URIRef(u'http://example.org/books/12345/resource')</span>

<span class="s2">    """</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rt</span> <span class="o">=</span> <span class="n">text_type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
            <span class="n">rt</span> <span class="o">=</span> <span class="n">text_type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="s1">'utf-8'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rt</span>

    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__mod__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">text_type</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"URIPattern(</span><span class="si">%r</span><span class="s2">)"</span> <span class="o">%</span> <span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ClosedNamespace</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    A namespace with a closed list of members</span>

<span class="sd">    Trying to create terms not listen is an error</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">terms</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="n">uri</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__uris</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__uris</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__uris</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uri</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="s2">"term '</span><span class="si">{}</span><span class="s2">' not in namespace '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">uri</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">term</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"__"</span><span class="p">):</span>  <span class="c1"># ignore any special Python names!</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">term</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">"rdf.namespace.ClosedNamespace(</span><span class="si">%r</span><span class="s2">)"</span> <span class="o">%</span> <span class="n">text_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">_RDFNamespace</span><span class="p">(</span><span class="n">ClosedNamespace</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Closed namespace for RDF terms</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">_RDFNamespace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">URIRef</span><span class="p">(</span><span class="s2">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span><span class="p">),</span>
            <span class="n">terms</span><span class="o">=</span><span class="p">[</span>
                <span class="c1"># Syntax Names</span>
                <span class="s2">"RDF"</span><span class="p">,</span> <span class="s2">"Description"</span><span class="p">,</span> <span class="s2">"ID"</span><span class="p">,</span> <span class="s2">"about"</span><span class="p">,</span> <span class="s2">"parseType"</span><span class="p">,</span>
                <span class="s2">"resource"</span><span class="p">,</span> <span class="s2">"li"</span><span class="p">,</span> <span class="s2">"nodeID"</span><span class="p">,</span> <span class="s2">"datatype"</span><span class="p">,</span>

                <span class="c1"># RDF Classes</span>
                <span class="s2">"Seq"</span><span class="p">,</span> <span class="s2">"Bag"</span><span class="p">,</span> <span class="s2">"Alt"</span><span class="p">,</span> <span class="s2">"Statement"</span><span class="p">,</span> <span class="s2">"Property"</span><span class="p">,</span>
                <span class="s2">"List"</span><span class="p">,</span> <span class="s2">"PlainLiteral"</span><span class="p">,</span>

                <span class="c1"># RDF Properties</span>
                <span class="s2">"subject"</span><span class="p">,</span> <span class="s2">"predicate"</span><span class="p">,</span> <span class="s2">"object"</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">,</span>
                <span class="s2">"value"</span><span class="p">,</span> <span class="s2">"first"</span><span class="p">,</span> <span class="s2">"rest"</span><span class="p">,</span>
                <span class="c1"># and _n where n is a non-negative integer</span>

                <span class="c1"># RDF Resources</span>
                <span class="s2">"nil"</span><span class="p">,</span>

                <span class="c1"># Added in RDF 1.1</span>
                <span class="s2">"XMLLiteral"</span><span class="p">,</span> <span class="s2">"HTML"</span><span class="p">,</span> <span class="s2">"langString"</span><span class="p">,</span>
            
                <span class="c1"># Added in JSON-LD 1.1</span>
                <span class="s2">"JSON"</span><span class="p">,</span> <span class="s2">"CompoundLiteral"</span><span class="p">,</span> <span class="s2">"language"</span><span class="p">,</span> <span class="s2">"direction"</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># Container membership properties</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'_'</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">_RDFNamespace</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">term</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>


<span class="n">RDF</span> <span class="o">=</span> <span class="n">_RDFNamespace</span><span class="p">()</span>


<span class="n">RDFS</span> <span class="o">=</span> <span class="n">ClosedNamespace</span><span class="p">(</span>
    <span class="n">uri</span><span class="o">=</span><span class="n">URIRef</span><span class="p">(</span><span class="s2">"http://www.w3.org/2000/01/rdf-schema#"</span><span class="p">),</span>
    <span class="n">terms</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">"Resource"</span><span class="p">,</span> <span class="s2">"Class"</span><span class="p">,</span> <span class="s2">"subClassOf"</span><span class="p">,</span> <span class="s2">"subPropertyOf"</span><span class="p">,</span> <span class="s2">"comment"</span><span class="p">,</span> <span class="s2">"label"</span><span class="p">,</span>
        <span class="s2">"domain"</span><span class="p">,</span> <span class="s2">"range"</span><span class="p">,</span> <span class="s2">"seeAlso"</span><span class="p">,</span> <span class="s2">"isDefinedBy"</span><span class="p">,</span> <span class="s2">"Literal"</span><span class="p">,</span> <span class="s2">"Container"</span><span class="p">,</span>
        <span class="s2">"ContainerMembershipProperty"</span><span class="p">,</span> <span class="s2">"member"</span><span class="p">,</span> <span class="s2">"Datatype"</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">OWL</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/2002/07/owl#'</span><span class="p">)</span>

<span class="n">XSD</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="n">_XSD_PFX</span><span class="p">)</span>

<span class="n">CSVW</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/csvw#'</span><span class="p">)</span>
<span class="n">DC</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://purl.org/dc/elements/1.1/'</span><span class="p">)</span>
<span class="n">DCAT</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/dcat#'</span><span class="p">)</span>
<span class="n">DCTERMS</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://purl.org/dc/terms/'</span><span class="p">)</span>
<span class="n">DOAP</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://usefulinc.com/ns/doap#'</span><span class="p">)</span>
<span class="n">FOAF</span> <span class="o">=</span> <span class="n">ClosedNamespace</span><span class="p">(</span>
    <span class="n">uri</span><span class="o">=</span><span class="n">URIRef</span><span class="p">(</span><span class="s1">'http://xmlns.com/foaf/0.1/'</span><span class="p">),</span>
    <span class="n">terms</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># all taken from http://xmlns.com/foaf/spec/</span>
        <span class="s1">'Agent'</span><span class="p">,</span> <span class="s1">'Person'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">,</span> <span class="s1">'title'</span><span class="p">,</span> <span class="s1">'img'</span><span class="p">,</span>
        <span class="s1">'depiction'</span><span class="p">,</span> <span class="s1">'depicts'</span><span class="p">,</span> <span class="s1">'familyName'</span><span class="p">,</span>
        <span class="s1">'givenName'</span><span class="p">,</span> <span class="s1">'knows'</span><span class="p">,</span> <span class="s1">'based_near'</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">,</span> <span class="s1">'made'</span><span class="p">,</span>
        <span class="s1">'maker'</span><span class="p">,</span> <span class="s1">'primaryTopic'</span><span class="p">,</span> <span class="s1">'primaryTopicOf'</span><span class="p">,</span> <span class="s1">'Project'</span><span class="p">,</span> <span class="s1">'Organization'</span><span class="p">,</span>
        <span class="s1">'Group'</span><span class="p">,</span> <span class="s1">'member'</span><span class="p">,</span> <span class="s1">'Document'</span><span class="p">,</span> <span class="s1">'Image'</span><span class="p">,</span> <span class="s1">'nick'</span><span class="p">,</span>
        <span class="s1">'mbox'</span><span class="p">,</span> <span class="s1">'homepage'</span><span class="p">,</span> <span class="s1">'weblog'</span><span class="p">,</span> <span class="s1">'openid'</span><span class="p">,</span> <span class="s1">'jabberID'</span><span class="p">,</span>
        <span class="s1">'mbox_sha1sum'</span><span class="p">,</span> <span class="s1">'interest'</span><span class="p">,</span> <span class="s1">'topic_interest'</span><span class="p">,</span> <span class="s1">'topic'</span><span class="p">,</span> <span class="s1">'page'</span><span class="p">,</span>
        <span class="s1">'workplaceHomepage'</span><span class="p">,</span> <span class="s1">'workInfoHomepage'</span><span class="p">,</span> <span class="s1">'schoolHomepage'</span><span class="p">,</span> <span class="s1">'publications'</span><span class="p">,</span> <span class="s1">'currentProject'</span><span class="p">,</span>
        <span class="s1">'pastProject'</span><span class="p">,</span> <span class="s1">'account'</span><span class="p">,</span> <span class="s1">'OnlineAccount'</span><span class="p">,</span> <span class="s1">'accountName'</span><span class="p">,</span> <span class="s1">'accountServiceHomepage'</span><span class="p">,</span>
        <span class="s1">'PersonalProfileDocument'</span><span class="p">,</span> <span class="s1">'tipjar'</span><span class="p">,</span> <span class="s1">'sha1'</span><span class="p">,</span> <span class="s1">'thumbnail'</span><span class="p">,</span> <span class="s1">'logo'</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">ODRL2</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/odrl/2/'</span><span class="p">)</span>
<span class="n">ORG</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/org#'</span><span class="p">)</span>
<span class="n">PROV</span> <span class="o">=</span> <span class="n">ClosedNamespace</span><span class="p">(</span>
    <span class="n">uri</span><span class="o">=</span><span class="n">URIRef</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/prov#'</span><span class="p">),</span>
    <span class="n">terms</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">'Entity'</span><span class="p">,</span> <span class="s1">'Activity'</span><span class="p">,</span> <span class="s1">'Agent'</span><span class="p">,</span> <span class="s1">'wasGeneratedBy'</span><span class="p">,</span> <span class="s1">'wasDerivedFrom'</span><span class="p">,</span>
        <span class="s1">'wasAttributedTo'</span><span class="p">,</span> <span class="s1">'startedAtTime'</span><span class="p">,</span> <span class="s1">'used'</span><span class="p">,</span> <span class="s1">'wasInformedBy'</span><span class="p">,</span> <span class="s1">'endedAtTime'</span><span class="p">,</span>
        <span class="s1">'wasAssociatedWith'</span><span class="p">,</span> <span class="s1">'actedOnBehalfOf'</span><span class="p">,</span> <span class="s1">'Collection'</span><span class="p">,</span> <span class="s1">'EmptyCollection'</span><span class="p">,</span> <span class="s1">'Bundle'</span><span class="p">,</span>
        <span class="s1">'Person'</span><span class="p">,</span> <span class="s1">'SoftwareAgent'</span><span class="p">,</span> <span class="s1">'Organization'</span><span class="p">,</span> <span class="s1">'Location'</span><span class="p">,</span> <span class="s1">'alternateOf'</span><span class="p">,</span>
        <span class="s1">'specializationOf'</span><span class="p">,</span> <span class="s1">'generatedAtTime'</span><span class="p">,</span> <span class="s1">'hadPrimarySource'</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">,</span> <span class="s1">'wasQuotedFrom'</span><span class="p">,</span>
        <span class="s1">'wasRevisionOf'</span><span class="p">,</span> <span class="s1">'invalidatedAtTime'</span><span class="p">,</span> <span class="s1">'wasInvalidatedBy'</span><span class="p">,</span> <span class="s1">'hadMember'</span><span class="p">,</span> <span class="s1">'wasStartedBy'</span><span class="p">,</span>
        <span class="s1">'wasEndedBy'</span><span class="p">,</span> <span class="s1">'invalidated'</span><span class="p">,</span> <span class="s1">'influenced'</span><span class="p">,</span> <span class="s1">'atLocation'</span><span class="p">,</span> <span class="s1">'generated'</span><span class="p">,</span>
        <span class="s1">'Influence'</span><span class="p">,</span> <span class="s1">'EntityInfluence'</span><span class="p">,</span> <span class="s1">'Usage'</span><span class="p">,</span> <span class="s1">'Start'</span><span class="p">,</span> <span class="s1">'End'</span><span class="p">,</span>
        <span class="s1">'Derivation'</span><span class="p">,</span> <span class="s1">'PrimarySource'</span><span class="p">,</span> <span class="s1">'Quotation'</span><span class="p">,</span> <span class="s1">'Revision'</span><span class="p">,</span> <span class="s1">'ActivityInfluence'</span><span class="p">,</span>
        <span class="s1">'Generation'</span><span class="p">,</span> <span class="s1">'Communication'</span><span class="p">,</span> <span class="s1">'Invalidation'</span><span class="p">,</span> <span class="s1">'AgentInfluence'</span><span class="p">,</span>
        <span class="s1">'Attribution'</span><span class="p">,</span> <span class="s1">'Association'</span><span class="p">,</span> <span class="s1">'Plan'</span><span class="p">,</span> <span class="s1">'Delegation'</span><span class="p">,</span> <span class="s1">'InstantaneousEvent'</span><span class="p">,</span>
        <span class="s1">'Role'</span><span class="p">,</span> <span class="s1">'wasInfluencedBy'</span><span class="p">,</span> <span class="s1">'qualifiedInfluence'</span><span class="p">,</span> <span class="s1">'qualifiedGeneration'</span><span class="p">,</span> <span class="s1">'qualifiedDerivation'</span><span class="p">,</span>
        <span class="s1">'qualifiedPrimarySource'</span><span class="p">,</span> <span class="s1">'qualifiedQuotation'</span><span class="p">,</span> <span class="s1">'qualifiedRevision'</span><span class="p">,</span> <span class="s1">'qualifiedAttribution'</span><span class="p">,</span>
        <span class="s1">'qualifiedInvalidation'</span><span class="p">,</span> <span class="s1">'qualifiedStart'</span><span class="p">,</span> <span class="s1">'qualifiedUsage'</span><span class="p">,</span> <span class="s1">'qualifiedCommunication'</span><span class="p">,</span> <span class="s1">'qualifiedAssociation'</span><span class="p">,</span>
        <span class="s1">'qualifiedEnd'</span><span class="p">,</span> <span class="s1">'qualifiedDelegation'</span><span class="p">,</span> <span class="s1">'influencer'</span><span class="p">,</span> <span class="s1">'entity'</span><span class="p">,</span> <span class="s1">'hadUsage'</span><span class="p">,</span> <span class="s1">'hadGeneration'</span><span class="p">,</span>
        <span class="s1">'activity'</span><span class="p">,</span> <span class="s1">'agent'</span><span class="p">,</span> <span class="s1">'hadPlan'</span><span class="p">,</span> <span class="s1">'hadActivity'</span><span class="p">,</span> <span class="s1">'atTime'</span><span class="p">,</span> <span class="s1">'hadRole'</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">PROF</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/dx/prof/'</span><span class="p">)</span>
<span class="n">SDO</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'https://schema.org/'</span><span class="p">)</span>
<span class="n">SH</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/shacl#'</span><span class="p">)</span>
<span class="n">SKOS</span> <span class="o">=</span> <span class="n">ClosedNamespace</span><span class="p">(</span>
    <span class="n">uri</span><span class="o">=</span><span class="n">URIRef</span><span class="p">(</span><span class="s1">'http://www.w3.org/2004/02/skos/core#'</span><span class="p">),</span>
    <span class="n">terms</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># all taken from https://www.w3.org/TR/skos-reference/#L1302</span>
        <span class="s1">'Concept'</span><span class="p">,</span> <span class="s1">'ConceptScheme'</span><span class="p">,</span> <span class="s1">'inScheme'</span><span class="p">,</span> <span class="s1">'hasTopConcept'</span><span class="p">,</span> <span class="s1">'topConceptOf'</span><span class="p">,</span>
        <span class="s1">'altLabel'</span><span class="p">,</span> <span class="s1">'hiddenLabel'</span><span class="p">,</span> <span class="s1">'prefLabel'</span><span class="p">,</span> <span class="s1">'notation'</span><span class="p">,</span> <span class="s1">'changeNote'</span><span class="p">,</span>
        <span class="s1">'definition'</span><span class="p">,</span> <span class="s1">'editorialNote'</span><span class="p">,</span> <span class="s1">'example'</span><span class="p">,</span> <span class="s1">'historyNote'</span><span class="p">,</span> <span class="s1">'note'</span><span class="p">,</span>
        <span class="s1">'scopeNote'</span><span class="p">,</span> <span class="s1">'broader'</span><span class="p">,</span> <span class="s1">'broaderTransitive'</span><span class="p">,</span> <span class="s1">'narrower'</span><span class="p">,</span> <span class="s1">'narrowerTransitive'</span><span class="p">,</span>
        <span class="s1">'related'</span><span class="p">,</span> <span class="s1">'semanticRelation'</span><span class="p">,</span> <span class="s1">'Collection'</span><span class="p">,</span> <span class="s1">'OrderedCollection'</span><span class="p">,</span> <span class="s1">'member'</span><span class="p">,</span>
        <span class="s1">'memberList'</span><span class="p">,</span> <span class="s1">'broadMatch'</span><span class="p">,</span> <span class="s1">'closeMatch'</span><span class="p">,</span> <span class="s1">'exactMatch'</span><span class="p">,</span> <span class="s1">'mappingRelation'</span><span class="p">,</span>
        <span class="s1">'narrowMatch'</span><span class="p">,</span> <span class="s1">'relatedMatch'</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">SOSA</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/ssn/'</span><span class="p">)</span>
<span class="n">SSN</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/ns/sosa/'</span><span class="p">)</span>
<span class="n">TIME</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://www.w3.org/2006/time#'</span><span class="p">)</span>
<span class="n">VOID</span> <span class="o">=</span> <span class="n">Namespace</span><span class="p">(</span><span class="s1">'http://rdfs.org/ns/void#'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NamespaceManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">"""</span>

<span class="sd">    Class for managing prefix =&gt; namespace mappings</span>

<span class="sd">    Sample usage from FuXi ...</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        ruleStore = N3RuleStore(additionalBuiltins=additionalBuiltins)</span>
<span class="sd">        nsMgr = NamespaceManager(Graph(ruleStore))</span>
<span class="sd">        ruleGraph = Graph(ruleStore,namespace_manager=nsMgr)</span>


<span class="sd">    and ...</span>

<span class="sd">    .. code-block:: pycon</span>

<span class="sd">        &gt;&gt;&gt; import rdflib</span>
<span class="sd">        &gt;&gt;&gt; from rdflib import Graph</span>
<span class="sd">        &gt;&gt;&gt; from rdflib.namespace import Namespace, NamespaceManager</span>
<span class="sd">        &gt;&gt;&gt; exNs = Namespace('http://example.com/')</span>
<span class="sd">        &gt;&gt;&gt; namespace_manager = NamespaceManager(Graph())</span>
<span class="sd">        &gt;&gt;&gt; namespace_manager.bind('ex', exNs, override=False)</span>
<span class="sd">        &gt;&gt;&gt; g = Graph()</span>
<span class="sd">        &gt;&gt;&gt; g.namespace_manager = namespace_manager</span>
<span class="sd">        &gt;&gt;&gt; all_ns = [n for n in g.namespace_manager.namespaces()]</span>
<span class="sd">        &gt;&gt;&gt; assert ('ex', rdflib.term.URIRef('http://example.com/')) in all_ns</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cache_strict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__log</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__strie</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__trie</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>  <span class="c1"># self.bind is not always called</span>
            <span class="n">insert_trie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trie</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"xml"</span><span class="p">,</span> <span class="s2">"http://www.w3.org/XML/1998/namespace"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"rdf"</span><span class="p">,</span> <span class="n">RDF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"rdfs"</span><span class="p">,</span> <span class="n">RDFS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">"xsd"</span><span class="p">,</span> <span class="n">XSD</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__strie</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__trie</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>  <span class="c1"># repopulate the trie</span>
            <span class="n">insert_trie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trie</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__get_store</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">store</span>
    <span class="n">store</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">__get_store</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_qname</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">":"</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">qname_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_qname_strict</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">''</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">':'</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">normalizeUri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdfTerm</span><span class="p">):</span>
        <span class="sd">"""</span>
<span class="sd">        Takes an RDF Term and 'normalizes' it into a QName (using the</span>
<span class="sd">        registered prefix) or (unlike compute_qname) the Notation 3</span>
<span class="sd">        form for URIs: &lt;...URI...&gt;</span>
<span class="sd">        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split_uri</span><span class="p">(</span><span class="n">rdfTerm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">namespace</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strie</span><span class="p">:</span>
                <span class="n">insert_strie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__strie</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trie</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">namespace</span><span class="p">))</span>
            <span class="n">namespace</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">text_type</span><span class="p">(</span><span class="n">namespace</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rdfTerm</span><span class="p">,</span> <span class="n">Variable</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">"?</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">rdfTerm</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">"&lt;</span><span class="si">%s</span><span class="s2">&gt;"</span> <span class="o">%</span> <span class="n">rdfTerm</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rdfTerm</span><span class="p">,</span> <span class="n">Variable</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">"?</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">rdfTerm</span>
        <span class="k">elif</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">"&lt;</span><span class="si">%s</span><span class="s2">&gt;"</span> <span class="o">%</span> <span class="n">rdfTerm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qNameParts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_qname</span><span class="p">(</span><span class="n">rdfTerm</span><span class="p">)</span>
            <span class="k">return</span> <span class="s1">':'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">qNameParts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qNameParts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">def</span> <span class="nf">compute_qname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">generate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_valid_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">'"</span><span class="si">{}</span><span class="s1">" does not look like a valid URI, cannot serialize this. Did you want to urlencode it?'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">uri</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cache</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">namespace</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
            <span class="k">if</span> <span class="n">namespace</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strie</span><span class="p">:</span>
                <span class="n">insert_strie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__strie</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trie</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strie</span><span class="p">[</span><span class="n">namespace</span><span class="p">]:</span>
                <span class="n">pl_namespace</span> <span class="o">=</span> <span class="n">get_longest_namespace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__strie</span><span class="p">[</span><span class="n">namespace</span><span class="p">],</span> <span class="n">uri</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pl_namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">namespace</span> <span class="o">=</span> <span class="n">pl_namespace</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">uri</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">namespace</span><span class="p">):]</span>

            <span class="n">namespace</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>  <span class="c1"># warning multiple prefixes problem</span>

            <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">generate</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s2">"No known prefix for </span><span class="si">{}</span><span class="s2"> and generate=False"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">"ns</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">num</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">namespace</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__cache</span><span class="p">[</span><span class="n">uri</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cache</span><span class="p">[</span><span class="n">uri</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">compute_qname_strict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">generate</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># code repeated to avoid branching on strict every time</span>
        <span class="c1"># if output needs to be strict (e.g. for xml) then</span>
        <span class="c1"># only the strict output should bear the overhead</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_qname</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_ncname</span><span class="p">(</span><span class="n">text_type</span><span class="p">(</span><span class="n">name</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">uri</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cache_strict</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">NAME_START_CATEGORIES</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'This graph cannot be serialized to a strict format '</span>
                               <span class="s1">'because there is no valid way to shorten </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                    <span class="c1"># omitted for strict since NCNames cannot be empty</span>
                    <span class="c1">#namespace = URIRef(uri)</span>
                    <span class="c1">#prefix = self.store.prefix(namespace)</span>
                    <span class="c1">#if not prefix:</span>
                        <span class="c1">#raise e</span>

                <span class="k">if</span> <span class="n">namespace</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__strie</span><span class="p">:</span>
                    <span class="n">insert_strie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__strie</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__trie</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>

                <span class="c1"># omitted for strict</span>
                <span class="c1">#if self.__strie[namespace]:</span>
                    <span class="c1">#pl_namespace = get_longest_namespace(self.__strie[namespace], uri)</span>
                    <span class="c1">#if pl_namespace is not None:</span>
                        <span class="c1">#namespace = pl_namespace</span>
                        <span class="c1">#name = uri[len(namespace):]</span>

                <span class="n">namespace</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>  <span class="c1"># warning multiple prefixes problem</span>

                <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">generate</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="s2">"No known prefix for </span><span class="si">{}</span><span class="s2"> and generate=False"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">"ns</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">num</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">namespace</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                            <span class="k">break</span>
                        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__cache_strict</span><span class="p">[</span><span class="n">uri</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cache_strict</span><span class="p">[</span><span class="n">uri</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">"""bind a given namespace to the prefix</span>

<span class="sd">        if override, rebind, even if the given namespace is already</span>
<span class="sd">        bound to another prefix.</span>

<span class="sd">        if replace, replace any existing prefix with the new namespace</span>

<span class="sd">        """</span>

        <span class="n">namespace</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">text_type</span><span class="p">(</span><span class="n">namespace</span><span class="p">))</span>
        <span class="c1"># When documenting explain that override only applies in what cases</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">''</span>
        <span class="n">bound_namespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">namespace</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="c1"># Check if the bound_namespace contains a URI</span>
        <span class="c1"># and if so convert it into a URIRef for comparison</span>
        <span class="c1"># This is to prevent duplicate namespaces with the</span>
        <span class="c1"># same URI</span>
        <span class="k">if</span> <span class="n">bound_namespace</span><span class="p">:</span>
            <span class="n">bound_namespace</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">bound_namespace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bound_namespace</span> <span class="ow">and</span> <span class="n">bound_namespace</span> <span class="o">!=</span> <span class="n">namespace</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
                <span class="n">insert_trie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trie</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">namespace</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="c1"># prefix already in use for different namespace</span>
            <span class="c1">#</span>
            <span class="c1"># append number to end of prefix until we find one</span>
            <span class="c1"># that's not in use.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="s2">"default"</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">new_prefix</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
                <span class="n">tnamespace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">namespace</span><span class="p">(</span><span class="n">new_prefix</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tnamespace</span> <span class="ow">and</span> <span class="n">namespace</span> <span class="o">==</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">tnamespace</span><span class="p">):</span>
                    <span class="c1"># the prefix is already bound to the correct</span>
                    <span class="c1"># namespace</span>
                    <span class="k">return</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">namespace</span><span class="p">(</span><span class="n">new_prefix</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">new_prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bound_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">prefix</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bound_prefix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">bound_prefix</span> <span class="o">==</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># already bound</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">override</span> <span class="ow">or</span> <span class="n">bound_prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"_"</span><span class="p">):</span>  <span class="c1"># or a generated prefix</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="n">insert_trie</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__trie</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">namespace</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">namespaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">namespaces</span><span class="p">():</span>
            <span class="n">namespace</span> <span class="o">=</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">namespace</span>

    <span class="k">def</span> <span class="nf">absolutize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">defrag</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="s2">"file:"</span><span class="p">,</span> <span class="n">pathname2url</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">urljoin</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">/"</span> <span class="o">%</span> <span class="n">base</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">allow_fragments</span><span class="o">=</span><span class="ow">not</span> <span class="n">defrag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">defrag</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">urldefrag</span><span class="p">(</span><span class="n">result</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">defrag</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">uri</span> <span class="ow">and</span> <span class="n">uri</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"#"</span> <span class="ow">and</span> <span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"#"</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2">#"</span> <span class="o">%</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">URIRef</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># From: http://www.w3.org/TR/REC-xml#NT-CombiningChar</span>
<span class="c1">#</span>
<span class="c1"># * Name start characters must have one of the categories Ll, Lu, Lo,</span>
<span class="c1">#   Lt, Nl.</span>
<span class="c1">#</span>
<span class="c1"># * Name characters other than Name-start characters must have one of</span>
<span class="c1">#   the categories Mc, Me, Mn, Lm, or Nd.</span>
<span class="c1">#</span>
<span class="c1"># * Characters in the compatibility area (i.e. with character code</span>
<span class="c1">#   greater than #xF900 and less than #xFFFE) are not allowed in XML</span>
<span class="c1">#   names.</span>
<span class="c1">#</span>
<span class="c1"># * Characters which have a font or compatibility decomposition</span>
<span class="c1">#   (i.e. those with a "compatibility formatting tag" in field 5 of the</span>
<span class="c1">#   database -- marked by field 5 beginning with a "&lt;") are not allowed.</span>
<span class="c1">#</span>
<span class="c1"># * The following characters are treated as name-start characters rather</span>
<span class="c1">#   than name characters, because the property file classifies them as</span>
<span class="c1">#   Alphabetic: [#x02BB-#x02C1], #x0559, #x06E5, #x06E6.</span>
<span class="c1">#</span>
<span class="c1"># * Characters #x20DD-#x20E0 are excluded (in accordance with Unicode</span>
<span class="c1">#   2.0, section 5.14).</span>
<span class="c1">#</span>
<span class="c1"># * Character #x00B7 is classified as an extender, because the property</span>
<span class="c1">#   list so identifies it.</span>
<span class="c1">#</span>
<span class="c1"># * Character #x0387 is added as a name character, because #x00B7 is its</span>
<span class="c1">#   canonical equivalent.</span>
<span class="c1">#</span>
<span class="c1"># * Characters ':' and '_' are allowed as name-start characters.</span>
<span class="c1">#</span>
<span class="c1"># * Characters '-' and '.' are allowed as name characters.</span>


<span class="n">NAME_START_CATEGORIES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Ll"</span><span class="p">,</span> <span class="s2">"Lu"</span><span class="p">,</span> <span class="s2">"Lo"</span><span class="p">,</span> <span class="s2">"Lt"</span><span class="p">,</span> <span class="s2">"Nl"</span><span class="p">]</span>
<span class="n">SPLIT_START_CATEGORIES</span> <span class="o">=</span> <span class="n">NAME_START_CATEGORIES</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'Nd'</span><span class="p">]</span>
<span class="n">NAME_CATEGORIES</span> <span class="o">=</span> <span class="n">NAME_START_CATEGORIES</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"Mc"</span><span class="p">,</span> <span class="s2">"Me"</span><span class="p">,</span> <span class="s2">"Mn"</span><span class="p">,</span> <span class="s2">"Lm"</span><span class="p">,</span> <span class="s2">"Nd"</span><span class="p">]</span>
<span class="n">ALLOWED_NAME_CHARS</span> <span class="o">=</span> <span class="p">[</span><span class="sa">u</span><span class="s2">"</span><span class="se">\u00B7</span><span class="s2">"</span><span class="p">,</span> <span class="sa">u</span><span class="s2">"</span><span class="se">\u0387</span><span class="s2">"</span><span class="p">,</span> <span class="sa">u</span><span class="s2">"-"</span><span class="p">,</span> <span class="sa">u</span><span class="s2">"."</span><span class="p">,</span> <span class="sa">u</span><span class="s2">"_"</span><span class="p">,</span> <span class="sa">u</span><span class="s2">":"</span><span class="p">]</span>


<span class="c1"># http://www.w3.org/TR/REC-xml-names/#NT-NCName</span>
<span class="c1">#  [4] NCName ::= (Letter | '_') (NCNameChar)* /* An XML Name, minus</span>
<span class="c1">#      the ":" */</span>
<span class="c1">#  [5] NCNameChar ::= Letter | Digit | '.' | '-' | '_' | CombiningChar</span>
<span class="c1">#      | Extender</span>


<span class="k">def</span> <span class="nf">is_ncname</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="s2">"_"</span> <span class="ow">or</span> <span class="n">category</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="ow">in</span> <span class="n">NAME_START_CATEGORIES</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">category</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="n">NAME_CATEGORIES</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">':'</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ALLOWED_NAME_CHARS</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">return</span> <span class="mi">0</span>
                <span class="c1"># if in compatibility area</span>
                <span class="c1"># if decomposition(c)!='':</span>
                <span class="c1">#    return 0</span>

            <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">0</span>


<span class="n">XMLNS</span> <span class="o">=</span> <span class="s2">"http://www.w3.org/XML/1998/namespace"</span>


<span class="k">def</span> <span class="nf">split_uri</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">split_start</span><span class="o">=</span><span class="n">SPLIT_START_CATEGORIES</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">XMLNS</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">XMLNS</span><span class="p">,</span> <span class="n">uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">XMLNS</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">uri</span><span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">category</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="n">NAME_CATEGORIES</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ALLOWED_NAME_CHARS</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">category</span><span class="p">(</span><span class="n">uri</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="ow">in</span> <span class="n">split_start</span> <span class="ow">or</span> <span class="n">uri</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"_"</span><span class="p">:</span>
                    <span class="c1"># _ prevents early split, roundtrip not generate</span>
                    <span class="n">ns</span> <span class="o">=</span> <span class="n">uri</span><span class="p">[:</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ns</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">ln</span> <span class="o">=</span> <span class="n">uri</span><span class="p">[</span><span class="n">j</span><span class="p">:]</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">ns</span><span class="p">,</span> <span class="n">ln</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Can't split '</span><span class="si">{}</span><span class="s2">'"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uri</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">insert_trie</span><span class="p">(</span><span class="n">trie</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  <span class="c1"># aka get_subtrie_or_insert</span>
    <span class="sd">""" Insert a value into the trie if it is not already contained in the trie.</span>
<span class="sd">        Return the subtree for the value regardless of whether it is a new value</span>
<span class="sd">        or not. """</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">trie</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">trie</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
    <span class="n">multi_check</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">trie</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">insert_trie</span><span class="p">(</span><span class="n">trie</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>  <span class="c1"># we know the value is not in the trie</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">multi_check</span><span class="p">:</span>
                <span class="n">trie</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">multi_check</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># there can be multiple longer existing prefixes</span>
            <span class="n">dict_</span> <span class="o">=</span> <span class="n">trie</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>  <span class="c1"># does not break strie since key&lt;-&gt;dict_ remains unchanged</span>
            <span class="n">trie</span><span class="p">[</span><span class="n">value</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trie</span><span class="p">:</span>
        <span class="n">trie</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">trie</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">insert_strie</span><span class="p">(</span><span class="n">strie</span><span class="p">,</span> <span class="n">trie</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">strie</span><span class="p">:</span>
        <span class="n">strie</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">insert_trie</span><span class="p">(</span><span class="n">trie</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_longest_namespace</span><span class="p">(</span><span class="n">trie</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">trie</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">get_longest_namespace</span><span class="p">(</span><span class="n">trie</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">key</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">out</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>

          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2021, Arcangelo Massari.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>